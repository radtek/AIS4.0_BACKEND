<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.digihealth.anesthesia.operProceed.dao.BasAnaesMonitorConfigDao">
   
   <resultMap id="BaseResultMap" type="com.digihealth.anesthesia.operProceed.po.BasAnaesMonitorConfig" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="regOptId" property="regOptId" jdbcType="VARCHAR" />
    <result column="color" property="color" jdbcType="VARCHAR" />
    <result column="iconId" property="iconId" jdbcType="VARCHAR" />
    <result column="eventId" property="eventId" jdbcType="VARCHAR" />
    <result column="deviceId" property="deviceId" jdbcType="VARCHAR" />
    <result column="max" property="max" jdbcType="REAL" />
    <result column="min" property="min" jdbcType="REAL" />
    <result column="position" property="position" jdbcType="INTEGER" />
    <result column="realEventId" property="realEventId" jdbcType="VARCHAR" />
    <result column="beid" property="beid" jdbcType="VARCHAR" />
    <result column="widthAndHeight" property="widthAndHeight" jdbcType="INTEGER" />
    <result column="docType" property="docType" jdbcType="INTEGER" />
  </resultMap>

  <sql id="Base_Column_List" >
    id, regOptId, color, iconId, eventId, deviceId, max, min, position, realEventId, 
    beid,widthAndHeight, docType
  </sql>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from bas_anaes_monitor_config
    where id = #{id,jdbcType=VARCHAR}
  </select>
   
   
   <select id="isIbpsList" resultType="java.lang.Integer">
   		SELECT COUNT(1) from (
   			SELECT a.*,b.eventName,b.eventDesc,b.units,b.mustShow
					FROM bas_anaes_monitor_config a,(select * from bas_monitor_config where beid = #{baseQuery.beid} and enable = 1) b
					WHERE a.realEventId = b.eventId 
					and a.beid = #{baseQuery.beid}
					and a.regOptId =  #{baseQuery.regOptId}
					and	a.position = #{baseQuery.position}
					and a.eventId in <foreach collection="baseQuery.eventIdItems" item ="item" index="index" open="(" separator="," close=")" >#{item}</foreach>
					and a.docType = #{baseQuery.docType}
					group by a.eventId
		) x
	</select>
   
   
	<select id="getAnaesMonitorConfigListByRegOptId" resultType="com.digihealth.anesthesia.operProceed.formbean.BasAnaesMonitorConfigFormBean">
		SELECT a.*,b.eventName,b.eventDesc,b.units,b.mustShow
					FROM bas_anaes_monitor_config a,(select * from bas_monitor_config where beid = #{baseQuery.beid} and enable = 1) b
					WHERE a.realEventId = b.eventId 
					and a.beid = #{baseQuery.beid}
					and a.regOptId =  #{baseQuery.regOptId}
					and	a.position = #{baseQuery.position}
					and a.docType = #{baseQuery.docType}
					group by a.eventId
	</select>
	
	<select id="getAnaesMonitorConfigByEventId" resultType="com.digihealth.anesthesia.operProceed.formbean.BasAnaesMonitorConfigFormBean">
		SELECT a.*,b.eventName,b.eventDesc
					FROM bas_anaes_monitor_config a,(select * from bas_monitor_config where beid = #{baseQuery.beid} and enable = 1) b
					WHERE a.realEventId = b.eventId 
					and a.beid = b.beid
					and a.beid = #{baseQuery.beid}
					and regOptId =  #{baseQuery.regOptId} 
					and a.eventId = #{baseQuery.eventId}
					and a.docType = #{baseQuery.docType}
	</select>
	
	
	<select id="getAnaesMonitorConfigEventId" resultType="com.digihealth.anesthesia.operProceed.formbean.BasAnaesMonitorConfigFormBean">
		SELECT 
		IFNULL(b.color, a.color) color,
		IFNULL(b.iconId, a.iconId) iconId,
		IFNULL(b.eventId, a.eventId) eventId,
		IFNULL(b.max,a.max) max,
		IFNULL(b.min,a.min) min,
		IFNULL(b.widthAndHeight,a.widthAndHeight) widthAndHeight,
		a.eventDesc,
		a.eventName
		FROM 
		(SELECT * FROM bas_monitor_config  WHERE eventId = #{baseQuery.eventId} and beid = #{baseQuery.eventId}) a 
		LEFT JOIN 
		(SELECT * FROM bas_anaes_monitor_config WHERE regOptId = #{baseQuery.regOptId} and beid = #{baseQuery.eventId} 
		AND eventId  = #{baseQuery.eventId} and docType = #{baseQuery.docType}) b 
		ON a.eventId = b.eventId 
	</select>
	
	<select id="getDefaultEventId" resultType="com.digihealth.anesthesia.operProceed.formbean.BasAnaesMonitorConfigFormBean">
		SELECT a.* FROM bas_anaes_monitor_config a,bas_monitor_config_default b
			WHERE a.eventId = b.`eventId`
			and a.beid = b.beid
			and a.beid = #{baseQuery.beid}
			AND a.`regOptId` = #{baseQuery.regOptId}
			AND b.`eventName` = #{baseQuery.name}
			AND a.`docType` = #{baseQuery.docType}
	</select>
	
	
	<select id="getAnaesRecordShowListByRegOptId" resultType="com.digihealth.anesthesia.operProceed.formbean.BasAnaesMonitorConfigFormBean">
	SELECT #{baseQuery.regOptId} as regOptId,c.color,c.iconId,c.eventId,a.deviceId,c.max,c.min,c.eventDesc,c.eventName,c.mustShow,c.units,c.position,c.widthAndHeight
		from (select * From bas_device_config where beid = #{baseQuery.beid} and roomId = #{baseQuery.operRoomId}) a,
		(select * from bas_monitor_config where beid = #{baseQuery.beid} and position= #{baseQuery.position} and enable = 1) c
		where a.deviceType = c.deviceType
		and c.mustShow = 1
		group by c.eventId
	</select>
	
	<select id="findAnaesMonitorRecordListByRegOptId" resultType="com.digihealth.anesthesia.operProceed.formbean.BasAnaesMonitorConfigFormBean" >
		select * from(
		SELECT 
			#{baseQuery.regOptId} AS regOptId,
			b.eventName,
			IFNULL(a.color,b.color) color,
			IFNULL(a.iconId,b.iconId) iconId, 
			b.eventId,
			b.position,
			IFNULL(a.`max`,b.`max`) max,
			IFNULL(a.`min`,b.`min`) min,
			IFNULL(a.widthAndHeight,b.widthAndHeight) widthAndHeight,
			IF (a.eventId > 0, '1', IF(b.mustShow = '1','1',0)) checked,
			b.mustShow,
			b.`units`,
			b.eventDesc
		FROM (SELECT * FROM bas_monitor_config WHERE beid = #{baseQuery.beid} and enable = 1) b LEFT JOIN 
		(SELECT * FROM bas_anaes_monitor_config  
			WHERE regOptId =  #{baseQuery.regOptId} 
			AND `position` = #{baseQuery.position} 
			and beid = #{baseQuery.beid} and docType = #{baseQuery.docType}) a
		ON a.realEventid = b.eventId
		where b.`position` = #{baseQuery.position}) t
		where 1 = 1
		<if test="baseQuery.enable!=null and baseQuery.enable!=''">
			and t.checked = #{baseQuery.enable}
		</if> 
		ORDER BY t.eventId
	</select>
	
	<select id="getEventNameGroupByRegOptId" resultType="com.digihealth.anesthesia.operProceed.formbean.BasAnaesMonitorConfigFormBean" >
		SELECT a.eventName FROM (SELECT * FROM bas_monitor_config WHERE beid = #{baseQuery.beid} AND ENABLE = 1) a,
		(SELECT * FROM bas_device_config WHERE beid = #{baseQuery.beid} AND roomId = #{baseQuery.operRoomId} GROUP BY deviceType) b
		WHERE a.deviceType = b.deviceType 
		AND a.position = #{baseQuery.position}
		GROUP BY a.eventName HAVING COUNT(1)>1
	</select>
	
	<update id="updateAnaesMonitorConfig" parameterType="com.digihealth.anesthesia.operProceed.po.BasAnaesMonitorConfig" >
	    update bas_anaes_monitor_config SET
	    color = #{color},
	    iconId = #{iconId},
	    eventId = #{eventId},
	    deviceId = #{deviceId},
	    max = #{max},
	    min = #{min},
	    widthAndHeight = #{widthAndHeight},
	    docType = #{docType},
	    realEventId = #{realEventId},
	    beid = #{beid}
	    where deviceId = #{deviceId,jdbcType=VARCHAR}  and  regOptId =  #{regOptId,jdbcType=VARCHAR}
	  </update>
  
  <update id="updateByEventId" parameterType="com.digihealth.anesthesia.operProceed.po.BasAnaesMonitorConfig" >
    update bas_anaes_monitor_config SET
    color = #{color},
    iconId = #{iconId},
    eventId = #{eventId},
    deviceId = #{deviceId},
    max = #{max},
    min = #{min},
    widthAndHeight = #{widthAndHeight},
    docType = #{docType},
    realEventId = #{realEventId},
    beid = #{beid}
    where eventId = #{eventId,jdbcType=VARCHAR}  and  regOptId =  #{regOptId,jdbcType=VARCHAR}
  </update>
	
	<delete id="delete">
		delete from bas_anaes_monitor_config 
		where regOptId = #{regOptId} 
		and position = #{position} 
		and docType = #{docType} 
		and eventId != '50021'
	</delete>
	
	<select id="getDeviceMonitorListByEventName" resultType="com.digihealth.anesthesia.basedata.formbean.DeviceMonitorFormbean">
		SELECT c.*,b.eventId FROM 
		(SELECT * FROM bas_device_config WHERE beid = #{baseQuery.beid} AND roomId = #{baseQuery.operRoomId} AND ENABLE = 1) a,
		(SELECT * FROM bas_monitor_config WHERE beid= #{baseQuery.beid} AND ENABLE = 1) b,
		 bas_device_specification c
		 WHERE a.deviceType = b.deviceType
		 AND a.deviceId =c.deviceId
		 AND b.eventName = #{baseQuery.name}
	</select>
	
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from bas_anaes_monitor_config
    where id = #{id,jdbcType=VARCHAR}
  </delete>

   <insert id="insert" parameterType="com.digihealth.anesthesia.operProceed.po.BasAnaesMonitorConfig" >
    insert into bas_anaes_monitor_config (id, regOptId, color, 
      iconId, eventId, deviceId, 
      max, min, position, realEventId, 
      beid,widthAndHeight, docType)
    values (#{id,jdbcType=VARCHAR}, #{regOptId,jdbcType=VARCHAR}, #{color,jdbcType=VARCHAR}, 
      #{iconId,jdbcType=VARCHAR}, #{eventId,jdbcType=VARCHAR}, #{deviceId,jdbcType=VARCHAR}, 
      #{max,jdbcType=REAL}, #{min,jdbcType=REAL}, #{position,jdbcType=INTEGER}, #{realEventId,jdbcType=VARCHAR}, 
      #{beid,jdbcType=VARCHAR},IFNULL(#{widthAndHeight,jdbcType=INTEGER},12),#{docType,jdbcType=INTEGER})
  </insert>

  <insert id="insertSelective" parameterType="com.digihealth.anesthesia.operProceed.po.BasAnaesMonitorConfig" >
    insert into bas_anaes_monitor_config
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="regOptId != null" >
        regOptId,
      </if>
      <if test="color != null" >
        color,
      </if>
      <if test="iconId != null" >
        iconId,
      </if>
      <if test="eventId != null" >
        eventId,
      </if>
      <if test="deviceId != null" >
        deviceId,
      </if>
      <if test="max != null" >
        max,
      </if>
      <if test="min != null" >
        min,
      </if>
      <if test="position != null" >
        position,
      </if>
      <if test="realEventId != null" >
        realEventId,
      </if>
      <if test="beid != null" >
        beid,
      </if>
      <if test = "widthAndHeight != null">
      widthAndHeight,
      </if>
      <if test = "docType != null">
      docType,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="regOptId != null" >
        #{regOptId,jdbcType=VARCHAR},
      </if>
      <if test="color != null" >
        #{color,jdbcType=VARCHAR},
      </if>
      <if test="iconId != null" >
        #{iconId,jdbcType=VARCHAR},
      </if>
      <if test="eventId != null" >
        #{eventId,jdbcType=VARCHAR},
      </if>
      <if test="deviceId != null" >
        #{deviceId,jdbcType=VARCHAR},
      </if>
      <if test="max != null" >
        #{max,jdbcType=REAL},
      </if>
      <if test="min != null" >
        #{min,jdbcType=REAL},
      </if>
      <if test="position != null" >
        #{position,jdbcType=INTEGER},
      </if>
      <if test="realEventId != null" >
        #{realEventId,jdbcType=VARCHAR},
      </if>
      <if test="beid != null" >
        #{beid,jdbcType=VARCHAR},
      </if>
      <if test = "widthAndHeight != null">
      #{widthAndHeight,jdbcType=INTEGER},
      </if>
      <if test = "docType != null">
      #{docType,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>

  <update id="updateByPrimaryKeySelective" parameterType="com.digihealth.anesthesia.operProceed.po.BasAnaesMonitorConfig" >
    update bas_anaes_monitor_config
    <set >
      <if test="regOptId != null" >
        regOptId = #{regOptId,jdbcType=VARCHAR},
      </if>
      <if test="color != null" >
        color = #{color,jdbcType=VARCHAR},
      </if>
      <if test="iconId != null" >
        iconId = #{iconId,jdbcType=VARCHAR},
      </if>
      <if test="eventId != null" >
        eventId = #{eventId,jdbcType=VARCHAR},
      </if>
      <if test="deviceId != null" >
        deviceId = #{deviceId,jdbcType=VARCHAR},
      </if>
      <if test="max != null" >
        max = #{max,jdbcType=REAL},
      </if>
      <if test="min != null" >
        min = #{min,jdbcType=REAL},
      </if>
      <if test="position != null" >
        position = #{position,jdbcType=INTEGER},
      </if>
      <if test="realEventId != null" >
        realEventId = #{realEventId,jdbcType=VARCHAR},
      </if>
      <if test="beid != null" >
        beid = #{beid,jdbcType=VARCHAR},
      </if>
      <if test = "widthAndHeight != null">
      	widthAndHeight = #{widthAndHeight , jdbcType = INTEGER},
      </if>
      <if test = "docType != null">
      	docType = #{docType,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>

  <update id="updateByPrimaryKey" parameterType="com.digihealth.anesthesia.operProceed.po.BasAnaesMonitorConfig" >
    update bas_anaes_monitor_config
    set regOptId = #{regOptId,jdbcType=VARCHAR},
      color = #{color,jdbcType=VARCHAR},
      iconId = #{iconId,jdbcType=VARCHAR},
      eventId = #{eventId,jdbcType=VARCHAR},
      deviceId = #{deviceId,jdbcType=VARCHAR},
      widthAndHeight = #{widthAndHeight , jdbcType = INTEGER}
      max = #{max,jdbcType=REAL},
      min = #{min,jdbcType=REAL},
      position = #{position,jdbcType=INTEGER},
      realEventId = #{realEventId,jdbcType=VARCHAR},
      beid = #{beid,jdbcType=VARCHAR},
      docType = #{docType,jdbcType=INTEGER}
    where id = #{id,jdbcType=VARCHAR}
  </update>
	
	
</mapper>